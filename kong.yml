_format_version: "3.0"
_transform: true

services:
  - name: users-service
    # AWS ECS Service Discovery DNS: {service-name}.{namespace}
    # In docker-compose: just "users"
    # In ECS: "users.hiver-dev.local" (set by SERVICE_DISCOVERY_NAMESPACE env var or default)
    host: users
    port: 3000
    protocol: http
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 0
    routes:
      - name: users-route
        paths:
          - /users
        methods:
          - GET
          - POST
          - PATCH
          - PUT
          - DELETE
          - OPTIONS
        strip_path: false
      - name: teams-route
        paths:
          - /teams
        methods:
          - GET
          - POST
          - PATCH
          - PUT
          - DELETE
          - OPTIONS
        strip_path: false
      - name: companies-route
        paths:
          - /companies
        methods:
          - GET
          - POST
          - PATCH
          - PUT
          - DELETE
          - OPTIONS
        strip_path: false
      - name: auth-route
        paths:
          - /auth
        methods:
          - GET
          - POST
          - OPTIONS
        strip_path: false
      - name: users-app-health
        paths:
          - /users-app/health
        methods:
          - GET
        strip_path: false
  - name: presence-service
    host: presence
    port: 3001
    protocol: http
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 0
    routes:
      - name: presence-checkin-route
        paths:
          - /checkincheckout
        methods:
          - GET
          - POST
          - OPTIONS
        strip_path: false
      - name: presence-nfc-tags-route
        paths:
          - /nfc-tags
        methods:
          - GET
          - POST
          - PATCH
          - PUT
          - DELETE
          - OPTIONS
        strip_path: false
      - name: presence-user-info-route
        paths:
          - /checkin-user-info
        methods:
          - GET
          - OPTIONS
        strip_path: false
      - name: presence-app-health
        paths:
          - /presence-app/health
        methods:
          - GET
        strip_path: false

  - name: leave-requests-service
    host: leave-requests
    port: 3002
    protocol: http
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 0
    routes:
      - name: leave-requests-route
        paths:
          - /leave-requests
        methods:
          - GET
          - POST
          - PATCH
          - PUT
          - DELETE
          - OPTIONS
        strip_path: false
      - name: leave-requests-app-health
        paths:
          - /leave-requests-app/health
        methods:
          - GET
        strip_path: false

  - name: tasks-service
    host: tasks
    port: 3003
    protocol: http
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 0
    routes:
      - name: tasks-route
        paths:
          - /tasks
        methods:
          - GET
          - POST
          - PATCH
          - PUT
          - DELETE
          - OPTIONS
        strip_path: false
      - name: tasks-app-health
        paths:
          - /tasks-app/health
        methods:
          - GET
        strip_path: false

plugins:
  - name: cors
    config:
      origins: ["*"]
      methods: [GET, POST, PATCH, PUT, DELETE, OPTIONS]
      headers: [Authorization, Content-Type]
      credentials: false
      max_age: 3600
