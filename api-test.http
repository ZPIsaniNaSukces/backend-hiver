@baseUrl = http://localhost:8000
@userId = 1
@teamId = 1
@companyId = 1

### Login as Admin
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "alice.admin@acme.com",
  "password": "ChangeMe123!"
}

###

@accessToken = {{login.response.body.accessToken}}
@accessTokenExpiresAt = {{login.response.body.accessTokenExpiresAt}}
@refreshToken = {{login.response.body.refreshToken}}
@refreshTokenExpiresAt = {{login.response.body.refreshTokenExpiresAt}}

### Refresh token
# @name refresh
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### Register user
# @name register
POST {{baseUrl}}/users/register
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "email": "alice.new456@acme.com",
  "companyId": {{companyId}},
  "bossId": {{userId}}
}

###
# Capture the temporary password from registration response
@newUserEmail = alice.new456@acme.com
@tempPassword = {{register.response.body.temporaryPassword}}

### Login as newly registered user with temporary password
# @name loginNewUser
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{newUserEmail}}",
  "password": "{{tempPassword}}"
}

###
@newUserAccessToken = {{loginNewUser.response.body.accessToken}}
@newUserId = {{loginNewUser.response.body.user.id}}

### Complete registration (for first-time login)
# User completes their registration after first login with generated password
PATCH {{baseUrl}}/users/{{newUserId}}/complete-registration
Content-Type: application/json
Authorization: Bearer {{newUserAccessToken}}

{
  "name": "Alice",
  "surname": "NewUser",
  "phone": "+11234567890",
  "password": "MyNewPassword123!"
}

### Verify complete registration - login with new password
# @name loginAfterComplete
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{newUserEmail}}",
  "password": "MyNewPassword123!"
}

### Get current user
GET {{baseUrl}}/auth/me
Authorization: Bearer {{accessToken}}

### Create user
POST {{baseUrl}}/users
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "John",
  "surname": "Doe",
  "email": "aaa.bbb@example.com",
  "password": "P@ssw0rd!",
  "phone": "+11234567890",
  "role": "EMPLOYEE",
  "companyId": {{companyId}}
}

### Get all users
GET {{baseUrl}}/users
Authorization: Bearer {{accessToken}}

### Get user by id
GET {{baseUrl}}/users/{{userId}}
Authorization: Bearer {{accessToken}}

### Update user
PATCH {{baseUrl}}/users/{{userId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Johnny B. Goode",
  "phone": "+11987654321"
}

### Delete user
DELETE {{baseUrl}}/users/{{userId}}
Authorization: Bearer {{accessToken}}

### Create company
POST {{baseUrl}}/companies
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Acme Corp",
  "domain": "acme.com"
}

### Get all companies
GET {{baseUrl}}/companies
Authorization: Bearer {{accessToken}}

### Get company by id
GET {{baseUrl}}/companies/{{companyId}}
Authorization: Bearer {{accessToken}}

### Update company
PATCH {{baseUrl}}/companies/{{companyId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Acme Corporation",
  "domain": "acme.example"
}

### Delete company
DELETE {{baseUrl}}/companies/{{companyId}}
Authorization: Bearer {{accessToken}}

### Create team
POST {{baseUrl}}/teams
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Engineering",
  "companyId": {{companyId}}
}

### Get all teams
GET {{baseUrl}}/teams
Authorization: Bearer {{accessToken}}

### Get team by id
GET {{baseUrl}}/teams/{{teamId}}
Authorization: Bearer {{accessToken}}

### Update team
PATCH {{baseUrl}}/teams/{{teamId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Product Engineering",
  "companyId": {{companyId}}
}

### Delete team
DELETE {{baseUrl}}/teams/{{teamId}}
Authorization: Bearer {{accessToken}}
