@baseUrl = http://localhost:8000
@userId = 1
@teamId = 1
@companyId = 1

### Login as Admin
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "alice.admin@acme.com",
  "password": "ChangeMe123!"
}

###

@accessToken = {{login.response.body.accessToken}}
@accessTokenExpiresAt = {{login.response.body.accessTokenExpiresAt}}
@refreshToken = {{login.response.body.refreshToken}}
@refreshTokenExpiresAt = {{login.response.body.refreshTokenExpiresAt}}

### Refresh token
# @name refresh
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### Register user
# @name register
POST {{baseUrl}}/users/register
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "email": "alice.new456@acme.com", #your real email here for testing
  "companyId": {{companyId}},
  "bossId": {{userId}}
}

###
# Capture the temporary password from registration response
@newUserEmail = alice.new456@acme.com
@tempPassword = {{register.response.body.temporaryPassword}}

### Login as newly registered user with temporary password
# @name loginNewUser
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{newUserEmail}}",
  "password": "{{tempPassword}}"
}

###
@newUserAccessToken = {{loginNewUser.response.body.accessToken}}
@newUserId = {{loginNewUser.response.body.user.id}}

### Complete registration (for first-time login)
# User completes their registration after first login with generated password
PATCH {{baseUrl}}/users/{{newUserId}}/complete-registration
Content-Type: application/json
Authorization: Bearer {{newUserAccessToken}}

{
  "name": "Alice",
  "surname": "NewUser",
  "phone": "+11234567890",
  "password": "MyNewPassword123!"
}

### Verify complete registration - login with new password
# @name loginAfterComplete
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{newUserEmail}}",
  "password": "MyNewPassword123!"
}

### Get current user
GET {{baseUrl}}/auth/me
Authorization: Bearer {{accessToken}}

### Create user
POST {{baseUrl}}/users
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "John",
  "surname": "Doe",
  "email": "aaa.bbb@example.com",
  "password": "P@ssw0rd!",
  "phone": "+11234567890",
  "role": "EMPLOYEE",
  "companyId": {{companyId}}
}

### Get all users
GET {{baseUrl}}/users
Authorization: Bearer {{accessToken}}

### Get all users - paginated (default: page=1, limit=10)
GET {{baseUrl}}/users?page=1&limit=10
Authorization: Bearer {{accessToken}}

### Get all users - page 1 with limit 2
GET {{baseUrl}}/users?page=1&limit=2
Authorization: Bearer {{accessToken}}

### Get all users - page 2 with limit 2
GET {{baseUrl}}/users?page=2&limit=2
Authorization: Bearer {{accessToken}}

### Search users - by name (case-insensitive)
GET {{baseUrl}}/users?search=Alice
Authorization: Bearer {{accessToken}}

### Search users - by surname
GET {{baseUrl}}/users?search=Admin
Authorization: Bearer {{accessToken}}

### Search users - by email
GET {{baseUrl}}/users?search=globex
Authorization: Bearer {{accessToken}}

### Search users - with pagination (search + limit)
GET {{baseUrl}}/users?search=a&limit=2
Authorization: Bearer {{accessToken}}

### Search users - partial match
GET {{baseUrl}}/users?search=mar
Authorization: Bearer {{accessToken}}

### Search users - no results
GET {{baseUrl}}/users?search=nonexistent
Authorization: Bearer {{accessToken}}

### Search + Pagination - page 1
GET {{baseUrl}}/users?search=a&page=1&limit=1
Authorization: Bearer {{accessToken}}

### Search + Pagination - page 2
GET {{baseUrl}}/users?search=a&page=2&limit=1
Authorization: Bearer {{accessToken}}

### Get user by id
GET {{baseUrl}}/users/{{userId}}
Authorization: Bearer {{accessToken}}

### Update user
PATCH {{baseUrl}}/users/{{userId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Johnny B. Goode",
  "phone": "+11987654321"
}

### Delete user
DELETE {{baseUrl}}/users/{{userId}}
Authorization: Bearer {{accessToken}}

### Create company
POST {{baseUrl}}/companies
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Acme Corp",
  "domain": "acme.com"
}

### Get all companies
GET {{baseUrl}}/companies
Authorization: Bearer {{accessToken}}

### Get company by id
GET {{baseUrl}}/companies/{{companyId}}
Authorization: Bearer {{accessToken}}

### Update company
PATCH {{baseUrl}}/companies/{{companyId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Acme Corporation",
  "domain": "acme.example"
}

### Delete company
DELETE {{baseUrl}}/companies/{{companyId}}
Authorization: Bearer {{accessToken}}

### Create team
POST {{baseUrl}}/teams
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Engineering",
  "companyId": {{companyId}}
}

### Get all teams
GET {{baseUrl}}/teams
Authorization: Bearer {{accessToken}}

### Get team by id
GET {{baseUrl}}/teams/{{teamId}}
Authorization: Bearer {{accessToken}}

### Update team
PATCH {{baseUrl}}/teams/{{teamId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "name": "Product Engineering",
  "companyId": {{companyId}}
}

### Delete team
DELETE {{baseUrl}}/teams/{{teamId}}
Authorization: Bearer {{accessToken}}

### ==================== AVAILABILITY REQUESTS ====================

### Create availability request (VACATION)
POST {{baseUrl}}/requests/availability
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "userId": {{userId}},
  "date": "2025-12-25",
  "hours": 8,
  "type": "VACATION"
}

### Create availability request (ONLINE_WORK)
POST {{baseUrl}}/requests/availability
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "userId": {{userId}},
  "date": "2025-12-26",
  "hours": 4,
  "type": "ONLINE_WORK"
}

### Create availability request (OFFLINE_WORK)
POST {{baseUrl}}/requests/availability
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "userId": {{userId}},
  "date": "2025-12-27",
  "hours": 8,
  "type": "OFFLINE_WORK"
}

### Get all availability requests
GET {{baseUrl}}/requests/availability
Authorization: Bearer {{accessToken}}

### Approve availability request
@availabilityRequestId = 1
POST {{baseUrl}}/requests/availability/{{availabilityRequestId}}/approve
Authorization: Bearer {{accessToken}}

### Reject availability request
POST {{baseUrl}}/requests/availability/{{availabilityRequestId}}/reject
Authorization: Bearer {{accessToken}}

### ==================== GENERAL REQUESTS ====================

### Create general request
POST {{baseUrl}}/requests/general
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "userId": {{userId}},
  "description": "Request for new equipment"
}

### Get all general requests
GET {{baseUrl}}/requests/general
Authorization: Bearer {{accessToken}}

### Approve general request
@generalRequestId = 1
POST {{baseUrl}}/requests/general/{{generalRequestId}}/approve
Authorization: Bearer {{accessToken}}

### Reject general request
POST {{baseUrl}}/requests/general/{{generalRequestId}}/reject
Authorization: Bearer {{accessToken}}
